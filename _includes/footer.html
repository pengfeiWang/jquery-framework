<!-- <script src="https://cdn.rawgit.com/pengfeiWang/jquery-framework/master/lib/jquery/1.9.0/jquery.js"></script> -->
<script src="/seajs/sea.js"></script>

<script>

	seajs.use('mousewheel', function ($) {
		var aside = $('#aside');
		var asideTitle = aside.find('.aside-title');
		var olvMousewheelBox = aside.find('.olvMousewheel-box');
		olvMousewheelBox.css({
			height: aside.height() - asideTitle.height() - 10
		});
		$.fn.olvScroll = function  ( ops ) {
			var defaultOps = {
				container: '.olvMousewheel-container',
				panel: '.olvMousewheel-panel',
				bar: '.olvMousewheel-bar',
				content: '.olvMousewheel-content'
			}
			var ops = $.extend({}, defaultOps, ops);
			var _this = $(this);
			

			this.each(function () {
				var childElem = {};
				var __this = $(this);
				childElem.root = __this;
				$.each(ops, function (i, v) {
					childElem[ i ] = $(v, __this);
				});
				var contentHeight = childElem.content.height(),
					rootHeight = __this.height()
					//,curPosition = childElem.panel.position().top
					;
				if( rootHeight >= contentHeight ){
					return false;
				}
				// 滚动条可以滚动的距离	
				var barScrollDis = rootHeight - childElem.bar.css({
					height: rootHeight/contentHeight*100 + '%'
				}).height();
				// 内容可以滚动的距离
				var scrollDis = contentHeight-rootHeight;

				__this.on('mouseover', function () {
					childElem.bar.show();
				});
				__this.on('mouseout', function () {
					childElem.bar.hide();
				});
				__this.mousewheel(function (e, delta) {
					var curPosition = childElem.panel.position().top;
					curPosition += delta;

					if( rootHeight >= contentHeight ){
						return false;
					}

					// 滚动的百分比
					var scrollProps =  Math.abs( 1/(scrollDis/curPosition) );
					if( delta <= -1 ) {
						if( scrollDis <= Math.abs(curPosition) ) {
							curPosition = -scrollDis ;
							scrollProps =  1;
							childElem.bar.css({
								top: barScrollDis * scrollProps + 'px'
							});
							childElem.panel.css({
								top: curPosition + 'px'
							});
							return false;
						}
					} else {
						if( curPosition >= 0 ){
							curPosition = 0;
							scrollProps =  0;
							childElem.bar.css({
								top: barScrollDis * scrollProps + 'px'
							});
							childElem.panel.css({
								top: curPosition + 'px'
							});
							return false;
						}
					}
					childElem.bar.css({
						top: barScrollDis * scrollProps + 'px'
					});
					childElem.panel.css({
						top: curPosition + 'px'
					});
					return false;
				})
			});
		}
		$('.olvMousewheel-box').olvScroll();		
	});
	

</script>
</body>
</html>