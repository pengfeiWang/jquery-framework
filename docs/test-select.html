<!DOCTYPE HTML>
<!--[if IE 9]>
<html class="IE9">
<![endif]-->
<!--[if lte IE 8]>
<html class="IE8">
<![endif]-->
<!--[if !IE]><!-->
<html>
<!--<![endif]-->
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"  name="viewport" >
<meta name="renderer" content="webkit|ie-stand">	
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<meta content="telephone=no" name="format-detection" />
<title>Untitled Document</title>
<meta name="Description" content="">
<meta name="Keywords" content="">
<link rel="stylesheet" type="text/css" href="../style/main.css">

</head>
<body>
<input type="text" placeholder="aa">
<span class="bk bk10"></span>
<form action="#">
	<select name="ttt2"  id="aa1" >
		<option selected>111</option>
		<option value="2" disabled>2</option>
		<option value="3">3</option>
		<option value="4">4</option>
		<optgroup label="开发">
	        <option value="前端开发">前端开发</option>
	        <option value="后端开发">后端开发</option>
	    </optgroup>
	</select>
	<span class="bk bk10"></span>
	<select name="ttt"  multiple=”multiple” id="aa">
		<option value="1" >1</option>
		<option value="2" selected="" disabled="">2</option>
		<option value="3" selected="">3</option>
		<option value="4">4</option>
		<optgroup label="分组">
	        <option value="前端开发">前端开发</option>
	        <option value="后端开发">后端开发</option>
	    </optgroup>
	</select>
	<span class="bk bk10"></span>
	<button type="submit" class="btn">提交</button>
</form>
<style>
	.item{
		height: 50px;
		border-bottom: 1px solid #fff;
	}
	.content{
		
	}
	.scrollbar{
		width: 20px;
		position: absolute;
		top:0;
		right:0;
		height: 100%;
		background-color: blue;
	}
	.scrollbar .bar{
		width: 20px;
		height: 10px;
		border-radius: 10px;
		background: red;
		position: absolute;
		top:0; 
		left:0;
	}
	.container{
		height: 100%;
		overflow: hidden;
		position: relative;
	}
	.panel{
		width: 100%;
		height: 100%;
		position: relative;
		left:0;
		top:0;
	}
</style>
<div id="mousewheel" style="width:500px; height: 400px; background:#ccc; position:relative; overflow:hidden">
	<div class="container">
		<div class="panel">
			<div class="content">
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
				<div class="item">
					列表1
				</div>
			</div>
		</div>
		<div class="scrollbar">
			<div class="bar"></div>
		</div>
	</div>
</div>
<div style="height:2000px;"></div>
<!-- <script src="../requirejs/require.js"></script> -->
<script src="../seajs/sea.js"></script>

<script>

// requirejs(['olvSelect', 'olvDialog', 'doT'], function ($, dialog, doT){
// 	console.log('require--:', $('body').select,  $.ui.dialog, doT )
// 	var s = '<li>{%=it.name%}</li>';
// 	var data = {
// 		name: 'sss'
// 	}

// 	console.log( doT(s, data) );

// });

seajs.use(['mousewheel', 'olvSelect', 'olvDialog', 'doT'], function ( $, dialog, doT ){
	
		/*
	select prop

	'olvSelect-wrap': obj.wrap,
	'olvSelect-optionBox': obj.optionBox,
	'olvSelect-ops': ops,
	'olvSelect-old': __this.val(),
	'olvSelect-oldNode': __this.children()
	'olvSelect-wrap': null,
	'olvSelect-data': null,
	'olvSelect-status':init open close disabled
	
	li prop -> data-value

	val: val,
	txt: txt,
	selected: selected,
	status: status
	pluginsName

	beforeCallBack: noop, // 初始化完成的回调
		openCallBack:   noop, // open 回调
		closeCallBack:  noop, // close 回调
		callBack:       noop // change 回调
	 */
	
	var classMap = [
		'.olvSelect',
		'.olvSelect-wrap',
		'.olvSelect-placeholder',
		'li'
	]
	var evtNameMap = [
		'init',
		'open',
		'close',
		'destroy',
		'restart',
		'change'
	]
	// var eventMap = {
	// 	'init': olvSelectInit
	// 	,'open': olvSelectOpen
	// 	,'close': olvSelectClose
	// 	,'destroy': olvSelectDestroy
	// 	,'restart': olvSelectRestart
	// 	// ,'olvSelect.setData': olvSelectSetData
	// }
	var s = '<li>{%=it.name%}</li>';
	var data = {
		name: 'sss'
	}

	var select = document.getElementById('aa')
	var sel = $('select')
	var ss = sel.olvSelect({
		before: function () {
			console.log( this, 'before')
		},
		open: function () {
			console.log( this, 'open')
		},
		close: function () {
			console.log( this, 'close')
		},
		change: function () {
			console.log( this, this.val(), 'change');
		}
	});


	$.fn.olvScroll = function  ( ops ) {
		var defaultOps = {
			container: '.container',
			panel: '.panel',
			bar: '.bar',
			content: '.content'
		}
		var ops = $.extend({}, defaultOps, ops);
		var _this = $(this);
		

		this.each(function () {
			var childElem = {};
			var __this = $(this);
			childElem.root = __this;
			$.each(ops, function (i, v) {
				childElem[ i ] = $(v, __this);
			});
			var contentHeight = childElem.content.height(),
				rootHeight = __this.height()
				//,curPosition = childElem.panel.position().top
				;
			// 滚动条可以滚动的距离	
			var barScrollDis = rootHeight - childElem.bar.css({
				height: rootHeight/contentHeight*100 + '%'
			}).height();
			// 内容可以滚动的距离
			var scrollDis = contentHeight-rootHeight;
			__this.mousewheel(function (e, delta) {
				var curPosition = childElem.panel.position().top;
				curPosition += delta;
				// 滚动的百分比
				var scrollProps =  Math.abs( 1/(scrollDis/curPosition) );
				if( delta <= -1 ) {
					if( scrollDis <= Math.abs(curPosition) ) {
						curPosition = -scrollDis ;
						scrollProps =  1;
						childElem.bar.css({
							top: barScrollDis * scrollProps + 'px'
						});
						childElem.panel.css({
							top: curPosition + 'px'
						});
						return false;
					}
				} else {
					if( curPosition >= 0 ){
						curPosition = 0;
						scrollProps =  0;
						childElem.bar.css({
							top: barScrollDis * scrollProps + 'px'
						});
						childElem.panel.css({
							top: curPosition + 'px'
						});
						return false;
					}
				}
				childElem.bar.css({
					top: barScrollDis * scrollProps + 'px'
				});
				childElem.panel.css({
					top: curPosition + 'px'
				});
				return false;
			})
		});
	}
	$('#mousewheel').olvScroll();
	sel.on('change', function () {
		console.log( this.value )
	})
	// ss.eq(1).olvSelectOpen()
	// sel.olvSelect.open()
	// ss.olvSelectDestroy()
	// $('select').olvSelect.open();
	// console.log( ss.parent() , ss)
	 
		// console.log( $('select').olvSelect({'width': '200px'}) )

	// $('form').on('submit', function (e) {
	// 	e.preventDefault();
	// 	console.log( $(this).serialize() )

	// })
});
</script>

</html>